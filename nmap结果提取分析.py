# coding=utf-8
import re
'''
nmap结果提取分析
这个脚本用来提取nmap探测到存在端口open的ip地址和端口，输出格式为
192.168.1.1
22/tcp open ssh
这里利用readlines的方式读取行数，文件过大此方法可能失效
'''
reip = re.compile(r"\b(?:[0-9]{1,3}\.){3}[0-9]{1,3}\b")
report= re.compile(r"^\d+/\w+.*open.*")
result1=[]
path=input("input your file path:\n")
s_file=open(path,'r')
count = len(open(path, 'r').readlines())
s_line=s_file.readlines()
print(count)
for i in range(0,count-1):
    j=i
    #print(s_line[i])
    if reip.findall(s_line[i]):
        if (len(result1)==0):
            ip=reip.findall(s_line[i])
            result1.append(ip)
    if report.findall(s_line[i]):
        port=report.findall(s_line[i])
        #print(port)
        result1.append(port)
    if reip.findall(s_line[j+1]):
        print(result1)
        if len(result1)>1:
            test = open('/Users/kris/Desktop/清算中心/office网络/未命名文件夹/ip10live_result.txt', 'a')
            for r in result1:
                r=""+str(r)
                r=r.replace('[', '')
                r = r.replace(']', '')
                r = r.replace("'", '')
                test.write(r+'\n')
            test.write('\n\n')
            test.close()
            result1 = []
